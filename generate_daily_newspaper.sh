#!/bin/bash
# æ¯æ—¥æ–°èžå ±ç´™ç”Ÿæˆè…³æœ¬
# æ¯å¤©ä¸Šåˆ8é»žé‹è¡Œ

echo "ðŸ“° $(date) - é–‹å§‹ç”Ÿæˆæ¯æ—¥æ–°èžå ±ç´™"
echo "=================================="

WORKSPACE="/home/node/.openclaw/workspace"
cd "$WORKSPACE"

# é‹è¡Œå ±ç´™ç”Ÿæˆå™¨
python3 "$WORKSPACE/skills/news_paper_generator.py"

EXIT_CODE=$?

if [ $EXIT_CODE -eq 0 ]; then
    echo "âœ… å ±ç´™ç”ŸæˆæˆåŠŸ"
    
    # ç²å–ä»Šå¤©ç”Ÿæˆçš„å ±ç´™
    TODAY=$(date +"%Y%m%d")
    NEWSPAPER_FILE="$WORKSPACE/memory/newspapers/newspaper_${TODAY}.txt"
    
    if [ -f "$NEWSPAPER_FILE" ]; then
        # é€™è£¡å¯ä»¥æ·»åŠ ç™¼é€åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š
        # - ç™¼é€åˆ°Telegram
        # - ç™¼é€éƒµä»¶
        # - ä¿å­˜åˆ°ç‰¹å®šä½ç½®
        
        echo "ðŸ“„ å ±ç´™æ–‡ä»¶: $NEWSPAPER_FILE"
        
        # é¡¯ç¤ºç°¡è¦å…§å®¹
        echo ""
        echo "ðŸ“‹ ä»Šæ—¥é ­æ¢:"
        echo "-----------"
        grep -A2 "ðŸ“° é ­æ¢æ–°èž" "$NEWSPAPER_FILE" | head -10
        
        echo ""
        echo "ðŸ“ˆ å¸‚å ´æ‘˜è¦:"
        echo "-----------"
        grep -A5 "ðŸ“ˆ é‡‘èžå¸‚å ´" "$NEWSPAPER_FILE" | head -10
        
    fi
else
    echo "âŒ å ±ç´™ç”Ÿæˆå¤±æ•—ï¼Œé€€å‡ºç¢¼: $EXIT_CODE"
    
    # ç”Ÿæˆç°¡æ˜“å ±ç´™
    TODAY=$(date +"%Y%m%d")
    SIMPLE_PAPER="$WORKSPACE/memory/newspapers/simple_${TODAY}.txt"
    
    cat > "$SIMPLE_PAPER" << SIMPLEEOF
ðŸ“° æ¯æ—¥ç°¡å ± - $(date +"%Yå¹´%mæœˆ%dæ—¥")
==================================

ç”±æ–¼æŠ€è¡“åŽŸå› ï¼Œä»Šæ—¥å®Œæ•´å ±ç´™ç”Ÿæˆé‡åˆ°å•é¡Œã€‚
ä»¥ä¸‹æ˜¯æ‚¨çš„å€‹äººåŒ–æ‘˜è¦ï¼š

ðŸ’¼ æŠ•è³‡æé†’:
â€¢ å®šæœŸæª¢è¦–æŠ•è³‡çµ„åˆè¡¨ç¾
â€¢ é—œæ³¨å¸‚å ´é‡è¦æ–°èž
â€¢ ä¿æŒæŠ•è³‡ç´€å¾‹

ðŸ“Š å¿«é€Ÿæª¢æŸ¥:
â€¢ åŸºæœ¬ç³»çµ±ç‹€æ…‹: æ­£å¸¸
â€¢ ç¶²çµ¡é€£æŽ¥: éƒ¨åˆ†æœå‹™å¯èƒ½å—é™
â€¢ æ•¸æ“šæ›´æ–°: æ‰‹å‹•æª¢æŸ¥å»ºè­°

ðŸŽ¯ ä»Šæ—¥å»ºè­°:
1. æª¢æŸ¥é‡è¦éƒµä»¶å’Œæ¶ˆæ¯
2. è¦åŠƒä»Šæ—¥å·¥ä½œé‡é»ž
3. ä¿æŒå¥åº·ç”Ÿæ´»ç¯€å¥

è¨»: å®Œæ•´å ±ç´™æœå‹™å°‡åœ¨ç¶²çµ¡æ¢å¾©å¾Œè‡ªå‹•æ›´æ–°ã€‚
SIMPLEEOF
    
    echo "âœ… å·²ç”Ÿæˆç°¡æ˜“å ±ç´™: $SIMPLE_PAPER"
fi

echo ""
echo "ðŸ•’ å®Œæˆæ™‚é–“: $(date)"
exit $EXIT_CODE
